<div class="virtual-scroll-container">
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
    <mat-tree-node *cdkTreeNodeDef="let node" cdkTreeNodePadding cdkTreeNodePaddingIndent="24">
      <button mat-icon-button disabled></button>
      {{ node.name }}
    </mat-tree-node>
    <mat-tree-node *cdkTreeNodeDef="let node; when: hasChild" cdkTreeNodePadding cdkTreeNodePaddingIndent="24">
      <button mat-icon-button [attr.aria-label]="'Toggle ' + node.item" matTreeNodeToggle>
        <mat-icon class="mat-icon-rtl-mirror">
          {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
        </mat-icon>
      </button>
      {{ node.name }}
    </mat-tree-node>
  </mat-tree>
</div>

<cdk-virtual-scroll-viewport class="virtual-scroll-container" itemSize="18">
  <ng-container *cdkVirtualFor="let node of dataSource">
    <!-- Note that the [style.padding-left] is essentially what cdkTreeNodePadding is doing under the hood -->
    <div class="node" [style.padding-left]="node.level * 24 + 'px'">
      <!-- Note that treeControl.toggle(node) is essentially what cdkTreeNodeToggle is doing under the hood -->
      <button (click)="treeControl.toggle(node)" *ngIf="node.hasChildren">
        {{ treeControl.isExpanded(node) ? '-' : '+' }}
      </button>
      {{ node.name }}
    </div>
  </ng-container>
</cdk-virtual-scroll-viewport>